---
import type { PublicAlbum } from "../lib/public-albums";

interface Props {
	albums: PublicAlbum[];
	galleryItems: { id: string; albumName: string; thumbUrl: string }[];
	adminBaseUrl: string;
	initialSection?: "gallery" | "services" | "contact" | "about";
}
const { albums, galleryItems, adminBaseUrl, initialSection } = Astro.props;
---

<!-- Hero -->
<section
	id="hero"
	data-page="hero"
	class="min-w-[100vw] w-[100vw] flex-shrink-0 snap-start flex flex-col justify-center items-center px-4 sm:px-6 lg:px-8"
>
	<div class="max-w-4xl mx-auto text-center">
		<h1 class="font-serif text-5xl sm:text-6xl lg:text-7xl font-light text-stone-900 leading-tight tracking-tight">
			Capturing Moments<br />
			<span class="italic text-stone-600">That Last Forever</span>
		</h1>
		<p class="mt-8 text-lg sm:text-xl text-stone-600 max-w-2xl mx-auto font-sans">
			Award-winning photography specializing in portrait, landscape, and event photography that tells your unique story.
		</p>
		<div class="mt-12 flex flex-wrap justify-center gap-4">
			<a
				href="/gallery"
				class="scroll-to-btn inline-flex items-center px-6 py-3 bg-stone-900 text-white font-medium rounded-sm hover:bg-stone-800 transition-colors no-underline"
			>
				Our Gallery
			</a>
			<a
				href="/contact"
				class="scroll-to-btn inline-flex items-center px-6 py-3 border border-stone-300 text-stone-700 font-medium rounded-sm hover:border-stone-400 hover:bg-stone-100 transition-colors no-underline"
			>
				Contact Me
			</a>
		</div>
	</div>
</section>

<!-- Gallery -->
<section
	id="gallery"
	data-page="gallery"
	class="min-w-[100vw] w-[100vw] flex-shrink-0 snap-start flex flex-col justify-center overflow-y-auto py-16 px-4 sm:px-6 lg:px-8 bg-white"
>
	<div class="max-w-7xl mx-auto w-full">
		<div class="text-center mb-12">
			<h2 class="font-serif text-4xl sm:text-5xl font-light text-stone-900">Gallery</h2>
			<p class="mt-4 text-stone-600 max-w-2xl mx-auto">
				A curated collection of moments frozen in time, each telling a unique story through light and shadow.
			</p>
		</div>
		{galleryItems.length > 0 ? (
			<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
				{galleryItems.map((item) => {
					const album = albums.find((a) => a.items.some((i) => i.id === item.id));
					return (
						<a
							href={album ? `/gallery/${album.slug}` : "#"}
							class="group block aspect-square overflow-hidden rounded-sm bg-stone-200"
						>
							<img
								src={item.thumbUrl}
								alt={item.albumName}
								loading="lazy"
								class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
							/>
						</a>
					);
				})}
			</div>
		) : (
			<p class="text-center text-stone-500 py-12">No photos yet. Check back soon.</p>
		)}
	</div>
</section>

<!-- Services -->
<section
	id="services"
	data-page="services"
	class="min-w-[100vw] w-[100vw] flex-shrink-0 snap-start flex flex-col justify-center overflow-y-auto py-16 px-4 sm:px-6 lg:px-8 bg-stone-100"
>
	<div class="max-w-7xl mx-auto w-full">
		<div class="text-center mb-12">
			<h2 class="font-serif text-4xl sm:text-5xl font-light text-stone-900">Our Services</h2>
			<p class="mt-4 text-stone-600 max-w-2xl mx-auto">
				Discover our range of professional photography services tailored to capture your unique moments.
			</p>
		</div>
		<div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
			<div class="bg-white p-8 rounded-sm shadow-sm">
				<h3 class="font-serif text-xl font-semibold text-stone-900">Portrait Photography</h3>
				<p class="mt-3 text-stone-600">
					Timeless portraits that capture your personality, perfect for individuals, families, or professionals.
				</p>
				<p class="mt-4 font-medium text-stone-900">From $200 · 1-hour session</p>
			</div>
			<div class="bg-white p-8 rounded-sm shadow-sm">
				<h3 class="font-serif text-xl font-semibold text-stone-900">Event Photography</h3>
				<p class="mt-3 text-stone-600">
					Capture every moment of your special events, from weddings to corporate gatherings.
				</p>
				<p class="mt-4 font-medium text-stone-900">From $500 · 4-hour coverage</p>
			</div>
			<div class="bg-white p-8 rounded-sm shadow-sm">
				<h3 class="font-serif text-xl font-semibold text-stone-900">Landscape Photography</h3>
				<p class="mt-3 text-stone-600">
					Breathtaking nature and cityscape photography for your home or office decor.
				</p>
				<p class="mt-4 font-medium text-stone-900">From $350 · Half-day session</p>
			</div>
		</div>
	</div>
</section>

<!-- Contact -->
<section
	id="contact"
	data-page="contact"
	class="min-w-[100vw] w-[100vw] flex-shrink-0 snap-start flex flex-col justify-center overflow-y-auto py-16 px-4 sm:px-6 lg:px-8 bg-white"
>
	<div class="max-w-2xl mx-auto w-full">
		<div class="text-center mb-12">
			<h2 class="font-serif text-4xl sm:text-5xl font-light text-stone-900">Contact Us</h2>
			<p class="mt-4 text-stone-600">
				Get in touch to discuss your photography needs or book a session.
			</p>
		</div>
		<form class="space-y-6" action="#" method="post">
			<div>
				<label for="name" class="block text-sm font-medium text-stone-700 mb-2">Name</label>
				<input
					type="text"
					id="name"
					name="name"
					required
					class="w-full px-4 py-3 border border-stone-300 rounded-sm focus:ring-2 focus:ring-stone-400 focus:border-stone-400 outline-none transition-shadow"
					placeholder="Your name"
				/>
			</div>
			<div>
				<label for="email" class="block text-sm font-medium text-stone-700 mb-2">Email</label>
				<input
					type="email"
					id="email"
					name="email"
					required
					class="w-full px-4 py-3 border border-stone-300 rounded-sm focus:ring-2 focus:ring-stone-400 focus:border-stone-400 outline-none transition-shadow"
					placeholder="you@example.com"
				/>
			</div>
			<div>
				<label for="message" class="block text-sm font-medium text-stone-700 mb-2">Message</label>
				<textarea
					id="message"
					name="message"
					rows="5"
					required
					class="w-full px-4 py-3 border border-stone-300 rounded-sm focus:ring-2 focus:ring-stone-400 focus:border-stone-400 outline-none transition-shadow resize-none"
					placeholder="Tell me about your project..."
				></textarea>
			</div>
			<button
				type="submit"
				class="w-full sm:w-auto px-8 py-3 bg-stone-900 text-white font-medium rounded-sm hover:bg-stone-800 transition-colors"
			>
				Send Message
			</button>
		</form>
	</div>
</section>

<!-- About -->
<section
	id="about"
	data-page="about"
	class="min-w-[100vw] w-[100vw] flex-shrink-0 snap-start flex flex-col justify-center overflow-y-auto py-16 px-4 sm:px-6 lg:px-8 bg-stone-100"
>
	<div class="max-w-2xl mx-auto prose prose-stone">
		<h2 class="font-serif text-4xl font-light text-stone-900">About</h2>
		<p class="text-stone-600 mt-6">
			I'm a professional photographer specializing in portrait, landscape, and event photography.
			With years of experience, I blend technical expertise with creative vision to tell compelling visual stories.
		</p>
		<p class="text-stone-600 mt-4">
			<a href="/contact" class="text-stone-900 font-medium hover:underline">Get in touch</a> to discuss your project.
		</p>
	</div>
	<footer class="mt-16 pt-8 border-t border-stone-200 text-center text-stone-500 text-sm">
		&copy; {new Date().getFullYear()} Moments. All rights reserved.
	</footer>
</section>

<script define:vars={{ initialSection }}>
	const SECTIONS = ['hero', 'gallery', 'services', 'contact', 'about'];
	let skipScrollSync = false;
	if ('scrollRestoration' in history) history.scrollRestoration = 'manual';

	function pathToSection(path) {
		if (path === '/' || path === '') return 'hero';
		const p = path.replace(/^\//, '');
		return SECTIONS.includes(p) ? p : 'hero';
	}

	function sectionToPath(section) {
		return section === 'hero' ? '/' : `/${section}`;
	}

	function getSectionFromScroll(scrollEl) {
		const sectionWidth = scrollEl.scrollWidth / SECTIONS.length;
		const center = scrollEl.scrollLeft + scrollEl.clientWidth / 2;
		const index = Math.min(Math.max(0, Math.floor(center / sectionWidth)), SECTIONS.length - 1);
		return SECTIONS[index];
	}

	function scrollToSection(section) {
		const el = document.getElementById(section);
		if (el) el.scrollIntoView({ behavior: 'smooth', inline: 'start', block: 'nearest' });
		const path = sectionToPath(section);
		if (location.pathname !== path) {
			history.pushState({ section }, '', path);
		}
		updateNavHighlight(section);
	}

	function updateNavHighlight(section) {
		document.querySelectorAll('.nav-scroll-link').forEach((a) => {
			const linkPath = a.getAttribute('href') || '/';
			const linkSection = pathToSection(linkPath);
			a.classList.toggle('nav-active', linkSection === section);
			a.setAttribute('aria-current', linkSection === section ? 'page' : null);
		});
	}

	function syncFromScroll() {
		if (skipScrollSync) return;
		const scroll = document.querySelector('main');
		if (!scroll) return;
		const section = getSectionFromScroll(scroll);
		const path = sectionToPath(section);
		updateNavHighlight(section);
		if (location.pathname !== path) {
			history.replaceState({ section }, '', path);
		}
	}

	document.addEventListener('DOMContentLoaded', () => {
		const scroll = document.querySelector('main');
		const sectionPaths = ['/', '/gallery', '/services', '/contact', '/about'];

		if (initialSection && SECTIONS.includes(initialSection)) {
			skipScrollSync = true;
			scrollToSection(initialSection);
			setTimeout(() => {
				skipScrollSync = false;
				syncFromScroll();
			}, 800);
		} else {
			if (scroll) scroll.scrollLeft = 0;
			updateNavHighlight('hero');
		}

		document.querySelectorAll('.scroll-to-btn, .nav-scroll-link').forEach((el) => {
			el.addEventListener('click', (e) => {
				const path = (el.getAttribute('href') || '/').split('?')[0];
				if (sectionPaths.includes(path)) {
					e.preventDefault();
					scrollToSection(pathToSection(path));
				}
			});
		});

		if (scroll) {
			let debounceId = 0;
			scroll.addEventListener('scroll', () => {
				clearTimeout(debounceId);
				debounceId = setTimeout(syncFromScroll, 120);
			});
		}

		window.addEventListener('popstate', (e) => {
			const section = e.state?.section ?? pathToSection(location.pathname);
			if (SECTIONS.includes(section)) scrollToSection(section);
		});
	});
</script>
